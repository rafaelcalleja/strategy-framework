var form2box=function(d,c){var b=this,f,a=$.trim(($(b).attr("method")||"get").toLowerCase()),g=(a&&$[a])?$[a]:$.post,k="#box-layer";var l=function(){var m=$("input[type='file']",b),e=m.length;
while(e--){if(!m[e].isComplete&&!$(m[e]).attr("complete")){return false;}}return true;};$(".filecontainer",b).each(function(p,s){var m=$("button",this),n=$("input",this),e=($(m).outerHeight()+4),q=($(m).width()+8),r=($(m).width()-q);
if($.browser.webkit){q+=6;}$(n).css({top:"-"+e+"px",left:"-"+r+"px",display:"inline"});$(this).hover(function(){$(m).focus();}).mouseout(function(){$(m).blur();
}).css({width:q+"px",height:e+"px",visibility:"visible"});});$("input[type='file']",b).change(function(B){var p=this;if(p.restoreForm){p.restoreForm();
}window.uploading=true;var E=$($(this).attr("target")),z=$(b).attr("action"),y=$(b).attr("mtd"),o=$(b).attr("enctype"),s=$(this),D=$(this).attr("filetype")||null,A=encodeURIComponent((new Date()).getTime());
p.isCanceled=false;p.isComplete=false;E.html("Inicializando...");try{$(p).removeAttr("complete");}catch(B){}var x=function(e,G){G=G||false;if(p.isCanceled){return;
}e=(e)?e:"";p.isCanceled=true;window.uploading=false;if(!G){s.val("");}if(p.lastProgress){delete (p.lastProgress);}var F=$(document.createElement("span")).html(e);
E.empty().append(F);return F[0];};var r=function(F,e){$(E).find(".progressbar").css("background-position",(100-F)+"% 50%");$(E).find("span").html(F+"% ("+e.upload+"Mb/"+e.total+"Mb)");
if(F==100){p.isComplete=true;}};var u=(new Date()).getTime();var m=function(I,H,G){var F=(!H)?"<":"";var e=x("<span class='link'>Limite de tama√±o excedido ("+I+"MB). Tu archivo pesa "+F+H+"MB</span>",true);
return false;};var n=function(K,F,H){p.isComplete=true;try{var J=(K.length>60)?K.substring(0,60)+"...":K,G=Math.round(parseInt((F)/1024));$(document.createElement("a")).attr({title:agd.strings.descargar+K+" ("+G+"Kb)",href:"getuploaded.php?action=dl",target:"async-frame"}).html(J+" <i>("+H+")</i>").appendTo(E);
}catch(I){$(E).html(agd.strings.error_texto);}try{$.fn.colorbox.resize();}catch(I){}if(btn=$("button.send",b).get(0)){btn.restore();}};E.html("<div id='uploadProgressBar' class='progressbar line-block'> </div>&nbsp;<span>0%</span> <a style='font-weight:normal'>Cancelar</a>");
$("a",E).click(function(){x("Cancelado por el usuario");});if((files=p.files)&&files[0]&&files[0].name){var C=p.files[0],t=C.size;if(t>agd.usermaxfile){return m(Math.round(agd.usermaxfile/1024/1024),Math.round(t/1024/1024),t);
}var v=function(){E.empty();n(C.name,t,C.type);window.uploading=false;$(b).data("pass",true);};var q=C.upload("uploadfiles.php",{onprogress:function(G){if(G.lengthComputable){var F=Math.round((G.loaded*100)/G.total);
r(F,{upload:Math.round(G.loaded/1024/1024),total:Math.round(G.total/1024/1024)});}},onsuccess:v,onerror:function(F){x("Error al subir el fichero");}});
$(E).find("a").click(function(){try{q.abort();}catch(F){}});}else{x("Error al subir el fichero");return false;}var w=window.setTimeout(function(){if((!p.isComplete&&typeof p.lastProgress=="undefined"||p.lastProgress==0)){E.html("<span><img src='"+agd.inlineLoadingImage+"' /> Subiendo, espera por favor... <a>Cancelar</a></span>");
$("a",E).click(function(){x("Cancelado por el usuario");});}},4000);return false;});var i=$("button.send",b).unbind("click").click(function(m){try{$(this).attr({disabled:true});
if(l()){$(this).find("span > span").html(agd.strings.enviando);$(b).submit();}else{$("span > span",this).html(agd.strings.esperando_cargar_archivos);}}catch(m){}return false;
}).removeAttr("disabled").get(0);try{var j=i.innerHTML;i.restore=function(){$(i).removeAttr("disabled");$(i).find("span > span").html(j);};}catch(h){}$(this).unbind("submit").submit(function(o){if(b.getAttribute("enctype")=="multipart/form-data"&&!$(b).data("pass")){if(!$(b).attr("rel")&&l()){window.uploading=false;
f();$(b).data("pass",true);$(b).submit();return false;}else{return true;}}else{if(agd.func.validateForm(b)){var p=$(b).serialize(),n=$(b).attr("action"),m=(n.indexOf("?")==-1)?"?":"&";
$("*[disabled]",b).each(function(){p=p+"&"+$(this).attr("name")+"="+encodeURIComponent($(this).val());});agd.func.open(n+m+p,false,a);}}return false;});
};if("File" in window){File.prototype.upload=function(a,b){b=b||{};b.method=(b.method)?b.method.toLowerCase():"put";b.onprogress=b.onprogress||function(){};
b.onload=b.onload||function(){};b.onsuccess=b.onsuccess||function(){};b.onerror=b.onerror||function(){};var c=new XMLHttpRequest();c.upload.onprogress=b.onprogress;
c.upload.onload=b.onload;c.upload.onerror=b.onerror;c.open(b.method,a,true);c.setRequestHeader("Content-Type","multipart/form-data");c.setRequestHeader("X-File-Name",this.name);
c.setRequestHeader("X-File-Size",this.size);c.setRequestHeader("X-File-Type",this.type);c.onreadystatechange=function(){if(c.readyState==4){if(c.status==200){b.onsuccess.apply(c);
}else{b.onerror.apply(c,[c.responseText]);}}};c.send(this);return c;};}