define(function(b,a,c){function d(u){var y,l,g,p,j,k,v=[],x,f,m,r;l=$(u).data("src");k=$(u).data("address");j=(j=$(u).data("activity"))?$(j):false;g=$(u).data("polling")||false;
streetViewControl=$(u).data("streetview")==false?false:true;var h=function(){if(!$.tipsy){return;}var A=$(this),B=A.attr("title"),z;if(B){A.removeAttr("title");
if(z=A.parent().parent()){z.attr("title",B).addClass("tipsy-map").tipsy().tipsy("show");}}};var n=function(){if(!$.tipsy){return;}$(u).find(".tipsy-map").tipsy("hide");
};var e=function(){if(l){$.getJSON(l,function(z){if(u.parentNode.parentNode){if(z.hash!=f){o(z.markers);if(j&&z.activity){j.html(z.activity);}f=z.hash;
}if(g){p=setTimeout(e,5000);}}});}else{if(k){geocoder.geocode({address:k},function(B,A){if(A==google.maps.GeocoderStatus.OK){var z=B[0].geometry.location;
w(z);x.setCenter(z);x.setZoom(13);}else{$(u).hide();}});}}};var s=function(){r=$(u).data("types")||[google.maps.MapTypeId.ROADMAP];x=new google.maps.Map(u,{mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{mapTypeIds:r},streetViewControl:streetViewControl});
$(u).on("hover","area",h);google.maps.event.addListener(x,"zoom_changed",n);geocoder=new google.maps.Geocoder();};var w=function(z,A){A=A||"";return marker=new google.maps.Marker({map:x,title:A,position:z,optimized:false});
};var q=function(){n();for(i in v){v[i].setMap(null);}};var o=function(A){q();m=new google.maps.LatLngBounds();var z=A.length;if(z){for(i in A){var D=A[i];
var C=new google.maps.LatLng(D.address[0],D.address[1]);var B=w(C,D.title);var E=(function(F){return function(){top.location.href=F.href;};})(D);google.maps.event.addListener(B,"click",E);
v.push(B);m.extend(B.position);}}x.fitBounds(m);if(x.getZoom()>12){x.setZoom(12);}if(!z){x.setZoom(2);}};var t=function(){s();e();};this.clear=function(){f=null;
};if(google&&google.maps&&google.maps.Map){t();}else{window.onMapsLoaded=function(){t();};}}return d;});