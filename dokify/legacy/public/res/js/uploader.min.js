define(function(b,a,c){function d(k){var i,n,l,e,g;i=this;l="async_upload_";e=0;n=null;g=0;function f(p,o){$(i).trigger("complete",[p,o])}function m(o){var p=Math.round((o.loaded*100)/o.total);$(i).trigger("progress",[p,o])}function j(o,p){n=new XMLHttpRequest();if(g&&p.size>g){return f(null,413)}n.upload.onprogress=m;n.open("put",o,true);n.setRequestHeader("Content-Type","multipart/form-data");n.setRequestHeader("X-File-Name",encodeURIComponent(p.name));n.setRequestHeader("X-File-Size",p.size);n.setRequestHeader("X-File-Type",p.type||"");n.onreadystatechange=function(){if(n.readyState==4){var q,r;q=n.responseText;r=n.getResponseHeader("Content-type");if(r.indexOf("application/json")!==-1){q=$.parseJSON(q)}if(n.status==200){f(q,n.status)}else{f(q,n.status)}}};n.send(p)}function h(p,z){var q,t,x,o,w,A,s,v,r,y,u;if(z.form){q=z.form;t=q.action;x=q.enctype;o=q.method;w=$(q).attr("target");A=$._data(q,"events");v=p.indexOf("?")===-1?"?":"&";y=l+(e++);s=[];r=$(document.createElement("iframe")).attr({id:y,name:y}).appendTo("body");n=r;if(A&&A.submit){for(u in A.submit){if(!isNaN(u)&&A.submit.hasOwnProperty(u)){s.push(A.submit[u].handler)}}$(q).off("submit")}$(r).one("load",function(){r.remove();setTimeout(function(){f()},1000)});window[y]=function(B,C){C=C||500;$(r).unbind("load").remove();f(B,C);window[y]=undefined};$(q).attr({action:p+v+"callback="+y,enctype:"multipart/form-data",method:"post",target:y}).submit();$(q).attr({action:t,enctype:x,method:o,target:w});for(u in s){$(q).on("submit",s[u])}}}this.setMaxSize=function(o){g=o};this.abort=function(){if(n){if(window.File&&k.files){n.onreadystatechange=function(){};n.abort()}else{$(n).remove()}}};this.submit=function(o){if(window.File&&k.files){return j(o,k.files[0])}else{return h(o,k)}}}d.init=function(){return new d(this)};return d});