(function(a,b){a.ahistory=a.ajaxHistory={curLocation:String,curPage:String,curParams:String,lastLocation:String,time:Number,marco:null,observer:Object,onChange:function(){},check:function(){},start:function(){this.time=250;if("onhashchange" in a&&a.onhashchange){a.onhashchange=ahistory.nativeMethod;ahistory.nativeMethod()}else{if(navigator.userAgent.indexOf("MSIE")!=-1){this.check=this.ie}else{this.check=this.ff}this.observe()}},nativeMethod:function(){var d=document.location.hash.replace("#","");ahistory.curLocation=d;ahistory.onChange(d)},getParams:function(f){f=f||this.curLocation;if(f.indexOf("?")==-1){return false}var g={},h=f.substring(f.indexOf("?")+1,f.length).split("&").sort(),e=h.length;if(!e){return false}while(e--){var d=h[e].split("=");if(d[0].indexOf("[]")==-1){g[d[0]]=d[1]}else{val=d[0].replace("[]","");if(!g[val]){g[val]=new Array}g[val].push(d[1])}}return g},getEncodedURI:function(){var g=this.getParams(),e=[],f=this.getPage(),d=0;for(vari in g){var h=g[vari];if(h){if(typeof h=="string"){e.push(vari+"="+encodeURIComponent(h))}else{pl=h.length;for(i=0;i<pl;i++){e.push(vari+"[]="+encodeURIComponent(h[i]))}}}}if(e.length){f+="?"+e.join("&")}return f},getPage:function(d){d=(d)?d:this.curLocation;if(d.indexOf("?")==-1){return d}else{return d.substring(0,d.indexOf("?"))}},observe:function(){this.observer=setInterval(this.check,this.time)},stop:function(){clearInterval(this.observer)},queryString:function(){var f=this.getParams(),e="",d=0;for(param in f){e+=param+"="+f[param]+"&"}e=e.substring(0,e.length-1);return e},getValue:function(d){var e=this.getParams();return e[d]},remove:function(e,d,g){c=g||this.curLocation;if(c.indexOf("?")==-1||c.indexOf(e)==-1){return 0}var f=e+"="+this.getValue(e);if(c.indexOf(f+"&")!=-1){f+="&"}c=c.replace(f,"");if(c.substring(c.length-1,c.length)=="&"){c=c.substring(0,c.length-1)}if(c.substring(c.length-1,c.length)=="?"){c=c.substring(0,c.length-1)}if(d){return c}location.hash=c},updateValue:function(h,g){if(typeof(h)=="object"){var k=this.curLocation;for(ob in h){if(h[ob]===null||!h[ob]){if(this.getValue(ob)){k=ahistory.remove(ob,true,k)}}else{var f=this.getValue(ob.toString());if(!f){var j={};j[ob]=h[ob];k=ahistory.add(j,k)}else{var d=ob.toString()+"="+f;var e=ob.toString()+"="+h[ob].toString();k=k.replace(d,e)}}}if(g){return k}location.hash=k}},add:function(f,h){var e=(h)?h:this.curLocation;var d=(e.indexOf("?")!=-1)?"&":"?";var j="";var g=0;for(v in f){cVal=f[v]||"";if(g==0){j+=d+v+"="+cVal.toString()}else{j+="&"+v+"="+cVal.toString();g++}}j=e+j;if(h){return j}location.hash=j},ff:function(){var d=ahistory;var e=document.location.hash.replace("#","");if(e!=d.curLocation){d.lastLocation=d.curLocation;d.curLocation=e;d.curPage=(d.curLocation.indexOf("?")!=-1)?d.curLocation.substring(0,d.curLocation.indexOf("?")):d.curLocation;d.curParams=d.curLocation.substring(d.curLocation.indexOf("?")+1,d.curLocation.length).split("&").sort().join("&");d.onChange(d.curLocation)}},ie:function(){var f=ahistory;if(a.navigator.userAgent.indexOf("MSIE 6.")!=-1){var d=document.location.href.split("#");try{var k=d[1]}catch(j){k=""}var g=k}else{var g=document.location.hash.replace("#","")}try{g=g.replace(/\&amp\;/g,"&")}catch(j){}if(!f.marco){f.makeFrame();f.marco.src="/blank.html";var h=f.marco.contentWindow.document;h.open();h.write("<html><body>"+encodeURI(g)+"</body></html>");h.close()}var l=f.marco.contentWindow.document.body.innerHTML.replace(/\&amp\;/g,"&");try{f.curLocation=f.curLocation.replace(/\&amp\;/g,"&")}catch(j){}if(g!=f.curLocation){try{f.curLocation=g.replace(/\&amp\;/g,"&")}catch(j){f.curLocation=""}try{f.curPage=(f.curLocation.indexOf("?")!=-1)?f.curLocation.substring(0,f.curLocation.indexOf("?")):f.curLocation;f.curParams=f.curLocation.substring(f.curLocation.indexOf("?")+1,f.curLocation.length).split("&").sort().join("&")}catch(j){}var h=f.marco.contentWindow.document;h.open();h.write("<html><body>"+g+"</body></html>");h.close();f.onChange(f.curLocation)}else{if(f.curLocation!=l){f.curLocation=l;f.curPage=(f.curLocation.indexOf("?")!=-1)?f.curLocation.substring(0,f.curLocation.indexOf("?")):f.curLocation;f.curParams=f.curLocation.substring(f.curLocation.indexOf("?")+1,f.curLocation.length).split("&").sort().join("&");location.hash=l;f.onChange(f.curLocation)}}},set:function(d,f){var e=ahistory,h=d.replace("#","");if(this.marco){var g=this.marco.contentWindow.document;g.open();g.write("<html><body>"+h+"</body></html>");g.close()}e.curLocation=h;location.href=d;if(f){ahistory.onChange(e.curLocation)}},makeFrame:function(){var d=document.createElement("IFRAME");d.style.display="none";d.name="app";document.body.appendChild(d);this.marco=d}}}(window));