define(function(b,a,c){function d(h){var i,h,g,f;f=$("#loading");i=this;i.delay=4000;var e=function(G){G.remote=G.remote||0;if(G&&G[0]){var p=new Date(G[0]*1000),y=(p.getMinutes().toString().length==1)?"0"+p.getMinutes():p.getMinutes(),t=(p.getSeconds().toString().length==1)?"0"+p.getSeconds():p.getSeconds()}if(G.access=="0"){return location.reload()}if(G.exit!==undefined){return location.href="/agd/salir.php?manual=1&loc="+G.exit}if(G.progress){if(G.progress=="-1"){f.hide()}else{f.show().find("div").html(G.progress)}}if(G.messages.length>0){var H=G.messages;var s;for(var C=0;C<H.length;C++){s=H[C];if(typeof agd.messages[s.uid]=="undefined"){break}}var B="system-message-"+s.uid,n=$("#"+B);if(!n.length){$("#cboxOverlay").css("opacity",0.5).show();n=$(document.createElement("div")).attr("id",B).addClass("system-message").appendTo(document.body);var J=$(document.createElement("div")).addClass("header").appendTo(n);if(s.title){var v=$(document.createElement("span")).addClass("title").appendTo(J).html(s.title.substring(0,50)).attr("title",s.title)}if(s.companyInviter){var x=$(document.createElement("span")).addClass("from").appendTo(J).html(s.companyInviter).attr("title",s.companyInviter)}var K=$(document.createElement("div")).addClass("message").appendTo(n).html(s.message);var I=$(document.createElement("div")).appendTo(n);var D=$(document.createElement("div")).addClass("footer").appendTo(I);if(s.action){$(document.createElement("a")).css("float","left").addClass("btn").html("<span><span>"+s.action+"</span></span>").appendTo(D).click(function(){if(s.href){agd.func.open(s.href)}else{$.post("userdata.php?message="+s.uid);$("#cboxOverlay").hide();n.hide()}return false})}var L=(s.cancelable!==undefined)?s.cancelable:false;if(L){$(document.createElement("a")).html("<span><span>"+agd.strings.no_volver_mostrar+"</span></span>").appendTo(D).click(function(){$.post("userdata.php?message="+s.uid);n.hide();$("#cboxOverlay").hide();return false})}$(document.createElement("a")).css("float","right").html("<span><span>"+agd.strings.recordar_mas_tarde+"</span></span>").appendTo(D).click(function(){agd.messages[s.uid]=true;n.hide();$("#cboxOverlay").hide();return false})}}if(G.remote){var q=(G.remote.status=="Conectado")?"succes":"error",w=(G.remote.status=="Conectado")?"":"none";$("#link-perfiles").hide();if(!window.isRemoteVisor){var m=$(document.createElement("div")).attr("id","control-remoto").addClass("estado-pagina").html("Control remoto <strong>"+G.remote["remote-user"]+"</strong> | ").insertBefore("#cuerpo");var A=$(document.createElement("a")).html("Volver").attr("href","../simular.php?action=return").click(function(){agd.func.simular(G.remote["user-id"]);return false}).appendTo(m);$(document.createTextNode(" | ")).appendTo(m);var z=$(document.createElement("a")).html("Me quedo!").attr("title","Cancela la simulación de este usuario y navega como si fueses él").attr("href","../simular.php?action=stay").appendTo(m);$(document.createTextNode(" | ")).appendTo(m);var r=function(M){if(window.isRemoteControl){$(M).html("Visualizar");window.isRemoteControl=false}else{$(M).html("Cancelar visualizacion");window.isRemoteControl=true}};var j=$(document.createElement("span")).attr("id","remote-user-control").css("display",w).appendTo(m);$(document.createElement("a")).html("Visualizar").click(function(){r(this);return false}).appendTo(j);$(document.createTextNode(" | ")).appendTo(j);var k=$(document.createElement("span")).css("display",w).attr("id","remote-user-actions").appendTo(m);$(document.createElement("span")).attr("id","remote-user-status").html(G.remote.status).addClass(q).appendTo(k);$(document.createTextNode(" | ")).appendTo(k);$(document.createElement("span")).attr("id","aviso-servertime").html(p.getHours()+":"+y+":"+t).appendTo(m)}else{i.setDelay(1000);$("#remote-user-actions, #remote-user-control").css("display",w);$("#aviso-servertime").html(p.getHours()+":"+y+":"+t);$("#remote-user-status").attr("className","").addClass(q).html(G.remote.status)}if(window.isRemoteVisor&&window.isRemoteControl&&G.remote.hash){var u=G.remote.hash,l=u.split("");if(l[0]=="#"){u=u.replace("#","");if(location.hash!=u){if(modalbox.exists()){modalbox.func.close()}location.hash=u}}else{if(u!=window.lastModalWindow){agd.func.open(u);window.lastModalWindow=u}}}window.isRemoteVisor=true}else{try{$("#link-perfiles").show();$("#control-remoto").remove();delete (window.isRemoteVisor);i.setDelay(4000)}catch(F){}}if(agd.iface=="validation"&&G.otherUserAssigned){$("button[type=submit].button").attr("disabled","disabled");alert(agd.strings.alert_validation_same_fileid);agd.navegar()}if(G.respuesta){$.each(G.respuesta,function(M,O){if(O.estado=="0"){return}var N="respuesta-"+O.uid;if(agd.cache.get(N)){return}$.each(agd.streaming.callback,function(P,Q){Q(O)});$.get("configurar/solicitud/eliminar.php?oid="+O.uid);if(O.estado){agd.cache.save(N,"true")}})}var o=["asignar","upload","transferencia","contratacion","subcontrata"],E;E=$(".avisos-principal ul li");if(G.solicitud){E.each(function(M,O){var N=$(O).prop("id"),Q=true,P=$(O).prop("class");if($.inArray(P,o)!==-1){$.each(G.solicitud,function(R,S){if(N=="aviso-"+S.uid){Q=false}});if(Q){agd.func.removeInPageAlert(O);agd.cache.save(N,"false")}}});$.each(G.solicitud,function(O,Q){var N="aviso-"+Q.uid,M=$("#"+N);if(Q.estado==3&&M.length){M[0].remove()}if(Q.estado==3||agd.cache.get(N)){return}if(M.length){return}try{var R=agd.create.inPageAlert(Q);$(R).prop("id",N);if(Q.className.indexOf("confirm")!==-1){$(R).click(function(){if(confirm("Aceptar solicitud?")){$.get("configurar/solicitud/validar.php?oid="+Q.uid,function(S){})}else{$.get("configurar/solicitud/rechazar.php?oid="+Q.uid,function(S){})}R.remove()})}}catch(P){return false}agd.cache.save(N,"true")})}else{E.each(function(){var M=$(this).prop("class");if($.inArray(M,o)!==-1){agd.func.removeInPageAlert($(this))}})}};this.setDelay=function(j){i.delay=j};this.update=function(){$.getJSON(h,function(j){e(j);g=setTimeout(i.update,i.delay)})};this.init=this.update}return d});