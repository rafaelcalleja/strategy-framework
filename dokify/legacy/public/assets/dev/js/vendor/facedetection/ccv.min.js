var ccv={array_group:function(n,c){var e,d;var b=new Array(n.length);for(e=0;e<n.length;e++){b[e]={parent:-1,element:n[e],rank:0};}for(e=0;e<n.length;e++){if(!b[e].element){continue;
}var f=e;while(b[f].parent!=-1){f=b[f].parent;}for(d=0;d<n.length;d++){if(e!=d&&b[d].element&&c(b[e].element,b[d].element)){var g=d;while(b[g].parent!=-1){g=b[g].parent;
}if(g!=f){if(b[f].rank>b[g].rank){b[g].parent=f;}else{b[f].parent=g;if(b[f].rank==b[g].rank){b[g].rank++;}f=g;}var l,k=d;while(b[k].parent!=-1){l=k;k=b[k].parent;
b[l].parent=f;}k=e;while(b[k].parent!=-1){l=k;k=b[k].parent;b[l].parent=f;}}}}}var h=new Array(n.length);var a=0;for(e=0;e<n.length;e++){d=-1;var m=e;if(b[m].element){while(b[m].parent!=-1){m=b[m].parent;
}if(b[m].rank>=0){b[m].rank=~a++;}d=~b[m].rank;}h[e]=d;}return{index:h,cat:a};},detect_objects:function(r,J,c,E){var L=Math.pow(2,1/(c+1));var e=c+1;var d=Math.floor(Math.log(Math.min(J.width,J.height))/Math.log(L));
var z=new Array((d+e*2)*4);z[0]=r;z[0].data=z[0].getContext("2d").getImageData(0,0,z[0].width,z[0].height).data;var Z,Y,X,Q,P,S;for(Z=1;Z<=c;Z++){z[Z*4]=document.createElement("canvas");
z[Z*4].width=Math.floor(z[0].width/Math.pow(L,Z));z[Z*4].height=Math.floor(z[0].height/Math.pow(L,Z));z[Z*4].getContext("2d").drawImage(z[0],0,0,z[0].width,z[0].height,0,0,z[Z*4].width,z[Z*4].height);
z[Z*4].data=z[Z*4].getContext("2d").getImageData(0,0,z[Z*4].width,z[Z*4].height).data;}for(Z=e;Z<d+e*2;Z++){z[Z*4]=document.createElement("canvas");z[Z*4].width=Math.floor(z[Z*4-e*4].width/2);
z[Z*4].height=Math.floor(z[Z*4-e*4].height/2);z[Z*4].getContext("2d").drawImage(z[Z*4-e*4],0,0,z[Z*4-e*4].width,z[Z*4-e*4].height,0,0,z[Z*4].width,z[Z*4].height);
z[Z*4].data=z[Z*4].getContext("2d").getImageData(0,0,z[Z*4].width,z[Z*4].height).data;}for(Z=e*2;Z<d+e*2;Z++){z[Z*4+1]=document.createElement("canvas");
z[Z*4+1].width=Math.floor(z[Z*4-e*4].width/2);z[Z*4+1].height=Math.floor(z[Z*4-e*4].height/2);z[Z*4+1].getContext("2d").drawImage(z[Z*4-e*4],1,0,z[Z*4-e*4].width-1,z[Z*4-e*4].height,0,0,z[Z*4+1].width-2,z[Z*4+1].height);
z[Z*4+1].data=z[Z*4+1].getContext("2d").getImageData(0,0,z[Z*4+1].width,z[Z*4+1].height).data;z[Z*4+2]=document.createElement("canvas");z[Z*4+2].width=Math.floor(z[Z*4-e*4].width/2);
z[Z*4+2].height=Math.floor(z[Z*4-e*4].height/2);z[Z*4+2].getContext("2d").drawImage(z[Z*4-e*4],0,1,z[Z*4-e*4].width,z[Z*4-e*4].height-1,0,0,z[Z*4+2].width,z[Z*4+2].height-2);
z[Z*4+2].data=z[Z*4+2].getContext("2d").getImageData(0,0,z[Z*4+2].width,z[Z*4+2].height).data;z[Z*4+3]=document.createElement("canvas");z[Z*4+3].width=Math.floor(z[Z*4-e*4].width/2);
z[Z*4+3].height=Math.floor(z[Z*4-e*4].height/2);z[Z*4+3].getContext("2d").drawImage(z[Z*4-e*4],1,1,z[Z*4-e*4].width-1,z[Z*4-e*4].height-1,0,0,z[Z*4+3].width-2,z[Z*4+3].height-2);
z[Z*4+3].data=z[Z*4+3].getContext("2d").getImageData(0,0,z[Z*4+3].width,z[Z*4+3].height).data;}for(Y=0;Y<J.stage_classifier.length;Y++){J.stage_classifier[Y].orig_feature=J.stage_classifier[Y].feature;
}var t=1,s=1;var m=[0,1,0,1];var l=[0,0,1,1];var H=[];for(Z=0;Z<d;Z++){var W=z[Z*4+e*8].width-Math.floor(J.width/4);var b=z[Z*4+e*8].height-Math.floor(J.height/4);
var N=[z[Z*4].width*4,z[Z*4+e*4].width*4,z[Z*4+e*8].width*4];var R=[z[Z*4].width*16-W*16,z[Z*4+e*4].width*8-W*8,z[Z*4+e*8].width*4-W*4];for(Y=0;Y<J.stage_classifier.length;
Y++){var A=J.stage_classifier[Y].orig_feature;var O=J.stage_classifier[Y].feature=new Array(J.stage_classifier[Y].count);for(X=0;X<J.stage_classifier[Y].count;
X++){O[X]={size:A[X].size,px:new Array(A[X].size),pz:new Array(A[X].size),nx:new Array(A[X].size),nz:new Array(A[X].size)};for(S=0;S<A[X].size;S++){O[X].px[S]=A[X].px[S]*4+A[X].py[S]*N[A[X].pz[S]];
O[X].pz[S]=A[X].pz[S];O[X].nx[S]=A[X].nx[S]*4+A[X].ny[S]*N[A[X].nz[S]];O[X].nz[S]=A[X].nz[S];}}}for(S=0;S<4;S++){var u=[z[Z*4].data,z[Z*4+e*4].data,z[Z*4+e*8+S].data];
var a=[m[S]*8+l[S]*z[Z*4].width*8,m[S]*4+l[S]*z[Z*4+e*4].width*4,0];for(P=0;P<b;P++){for(Q=0;Q<W;Q++){var B=0;var M=true;for(Y=0;Y<J.stage_classifier.length;
Y++){B=0;var V=J.stage_classifier[Y].alpha;var O=J.stage_classifier[Y].feature;for(X=0;X<J.stage_classifier[Y].count;X++){var F=O[X];var T,ac=u[F.pz[0]][a[F.pz[0]]+F.px[0]];
var U,K=u[F.nz[0]][a[F.nz[0]]+F.nx[0]];if(ac<=K){B+=V[X*2];}else{var aa,h=true;for(aa=0;aa<F.size;aa++){if(F.pz[aa]>=0){T=u[F.pz[aa]][a[F.pz[aa]]+F.px[aa]];
if(T<ac){if(T<=K){h=false;break;}ac=T;}}if(F.nz[aa]>=0){U=u[F.nz[aa]][a[F.nz[aa]]+F.nx[aa]];if(U>K){if(ac<=U){h=false;break;}K=U;}}}B+=(h)?V[X*2+1]:V[X*2];
}}if(B<J.stage_classifier[Y].threshold){M=false;break;}}if(M){H.push({x:(Q*4+m[S]*2)*t,y:(P*4+l[S]*2)*s,width:J.width*t,height:J.height*s,neighbor:1,confidence:B});
}a[0]+=16;a[1]+=8;a[2]+=4;}a[0]+=R[0];a[1]+=R[1];a[2]+=R[2];}}t*=L;s*=L;}for(Y=0;Y<J.stage_classifier.length;Y++){J.stage_classifier[Y].feature=J.stage_classifier[Y].orig_feature;
}if(!(E>0)){return H;}else{var C=ccv.array_group(H,function(i,f){var j=Math.floor(i.width*0.25+0.5);return f.x<=i.x+j&&f.x>=i.x-j&&f.y<=i.y+j&&f.y>=i.y-j&&f.width<=Math.floor(i.width*1.5+0.5)&&Math.floor(f.width*1.5+0.5)>=i.width;
});var ab=C.cat;var I=C.index;var g=new Array(ab+1);for(Z=0;Z<g.length;Z++){g[Z]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};}for(Z=0;Z<H.length;
Z++){var w=H[Z];var ad=I[Z];if(g[ad].neighbors==0){g[ad].confidence=w.confidence;}++g[ad].neighbors;g[ad].x+=w.x;g[ad].y+=w.y;g[ad].width+=w.width;g[ad].height+=w.height;
g[ad].confidence=Math.max(g[ad].confidence,w.confidence);}var o=[];for(Z=0;Z<ab;Z++){var U=g[Z].neighbors;if(U>=E){o.push({x:(g[Z].x*2+U)/(2*U),y:(g[Z].y*2+U)/(2*U),width:(g[Z].width*2+U)/(2*U),height:(g[Z].height*2+U)/(2*U),neighbors:g[Z].neighbors,confidence:g[Z].confidence});
}}var G=[];for(Z=0;Z<o.length;Z++){var w=o[Z];var M=true;for(Y=0;Y<o.length;Y++){var v=o[Y];var D=Math.floor(v.width*0.25+0.5);if(Z!=Y&&w.x>=v.x-D&&w.y>=v.y-D&&w.x+w.width<=v.x+v.width+D&&w.y+w.height<=v.y+v.height+D&&(v.neighbors>Math.max(3,w.neighbors)||w.neighbors<3)){M=false;
break;}}if(M){G.push(w);}}return G;}}};