define(function(){var a=angular.module("services",["ngResource"]);a.factory("readOnly",[function(){var b=angular.element(document.body).attr("data-read-only")==="true";
return b;}]);a.factory("timeStorage",["localStorageService",function(c){function b(){this.set=function(e,g,d){var f={};f.key=e;f.value=g;f.createdAt=(new Date()).getTime();
f.expiresAt=0;if(d){f.expiresAt=f.createdAt+(d*1000);}c.set(e,f);};this.get=function(d){var e=c.get(d),f=(new Date()).getTime();if(e===null){return;}if(e.expiresAt&&Offline.state==="up"){if(e.expiresAt<=f){c.remove(d);
return;}}return e.value;};this.remove=function(d){c.remove(d);};}return new b();}]);a.factory("OfflineCache",["$cacheFactory","timeStorage",function(e,b){function d(f){this.cache=f;
}d.prototype.info=function(){return this.cache.info();};d.prototype.put=function(f,g){if(typeof g.then==="undefined"){b.set(f,g,60*60);}this.cache.put(f,g);
};d.prototype.get=function(g){var f=b.get(g);if(f&&f[0]!==undefined){return f;}return this.cache.get(g);};d.prototype.remove=function(f){b.remove(f);this.cache.remove(f);
};d.prototype.removeAll=function(){this.cache.removeAll();};d.prototype.destroy=function(){this.cache.destroy();};d.prototype.update=function(h,i){var g=b.get(h);
if(!g){this.cache.remove(h);return;}var f=angular.fromJson(g[1]);if(!f){throw new Error("no cached data from "+h+" ["+g[1]+"]");}f=angular.extend(f,i);
g[1]=angular.toJson(f);this.put(h,g);};function c(f){return new d(e(f));}return c;}]);a.factory("Login",["$resource","OfflineCache",function(d,f){var c,b,e;
c="/app/settings/profile";b=f("login");e=d(c,{},{get:{cache:b,headers:{"X-Timezone":function(){return jstz.determine().name();},"X-Timezone-Offset":function(){return(new Date()).getTimezoneOffset()/60;
}}},update:{method:"PUT",interceptor:{response:function(g){b.update(c,g.config.data);return g;}}}});e.cache=function(g){b.update(c,g);};e.clearCache=function(){b.remove(c);
};return e;}]);a.factory("MapService",["$q",function(b){var c=function(){};c.$promise=b(function(g,f){var d=document.createElement("script"),e;if(window.google&&google.maps&&google.maps.Map){return g(google.maps);
}window.onMapsLoaded=function(){if(e){clearInterval(e);}g(google.maps);};e=setTimeout(f,5000);d.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXk-m2W1u-796B9lFjVWvqbNmlqnNUCZ0&sensor=false&callback=onMapsLoaded";
document.getElementsByTagName("head")[0].appendChild(d);});return c;}]);a.factory("Geolocator",["$q",function(c){function b(){}b.prototype.getPosition=function(g){var h,f;
f=navigator.geolocation;h=c.defer();function e(j){var l=j.coords;log("Location resolved {latitude: "+l.latitude+", longitude: "+l.longitude+"}");if(g&&g.latitude&&g.longitude){var k=g.latitude.toFixed(4)!==l.latitude.toFixed(4),i=g.longitude.toFixed(4)!==l.longitude.toFixed(4),m=k||k;
if(m===false){log("Location hasn't changed");return;}}log("New location acquired");h.resolve({latitude:l.latitude,longitude:l.longitude});}function d(i){if(i.code===3){log("Resolving location with 60 sec timeout...");
f.getCurrentPosition(e,function(j){h.reject(j);},{enableHighAccuracy:true,maximumAge:0,timeout:60000});return;}log("Unable to resolve location ["+i.code+"]");
h.reject(i);}log("Resolving location...");f.getCurrentPosition(e,d,{enableHighAccuracy:true,maximumAge:0,timeout:10000});return h.promise;};return new b;
}]);a.factory("Layout",function(){function b(){this.baseTitle=document.title||"dokify";this.loading=true;this.inNav=false;this.error=false;this.inProfiles=false;
this.modal=false;this.modalText=false;this.modalTitle=false;}b.prototype.setTitle=function(c){this.title=c+" - "+this.baseTitle;document.title=this.title;
};b.prototype.toggleProfiles=function(c){this.inProfiles=c!==undefined?c:!this.inProfiles;};b.prototype.toggleNav=function(c){this.inNav=c!==undefined?c:!this.inNav;
if(this.inNav===false){this.inProfiles=false;}};b.prototype.showModal=function(d,c){this.modalTitle=d!==undefined?d:"";this.modalText=c!==undefined?c:"";
this.modal=true;};return new b;});a.factory("Company",["$resource",function(b){return b("/app/company/:company");}]);a.factory("Employee",["$resource",function(b){return b("/app/employee/:employee",{},{get:{method:"GET",headers:{Scopes:"uid,name,vat,logo,checkin,companies.uid,companies.employee,companies.shortname,companies.vat"}}});
}]);a.factory("Profile",["$resource",function(b){return b("/app/profile/:profile");}]);a.factory("User",["$resource","$cacheFactory",function(c,d){var b=d("users");
return c("/app/user/:user",{},{once:{cache:b}});}]);a.factory("Search",["$resource",function(c){var b=c("/app/search",{},{employees:{method:"GET",isArray:true,params:{type:"empleado",all:false}}});
return b;}]);a.factory("Assignment",["$resource",function(b){return b("/app/assignment/:assignment");}]);a.factory("AssignmentRelevant",["$resource",function(b){return b("/app/employee/:employee/assigns/relevant");
}]);a.factory("Checkin",["$resource",function(c){var b=c("/app/checkin/:checkin",{},{get:{interceptor:{response:function(d){d.data.distance=parseFloat(d.headers("X-Location-Distance"),10);
d.data.is_near=d.data.distance<2000;return d.data;}}},checkout:{method:"PUT",params:{checkin:"@checkin",checkout:true}},summary:{method:"GET",params:{format:"summary",interval:"P30D"}}});
b.access=function(e){var d=e.status;if(d===2){return"ko";}if(d===3){return"deny";}if(d===4){return"innacesible";}return"ok";};return b;}]);a.filter("checkin_access",["Checkin",function(b){return b.access;
}]);});