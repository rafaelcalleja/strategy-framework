define(["janddress"],function(){var g,f,d,o,a,k;f=$('head meta[http-equiv="App-Version"]').attr("content");k=$('head meta[http-equiv="App-Base"]').attr("content");
d=$("head title").attr("name")||"";function b(t){var r,q,s,p;q=t.getResponseHeader("App-Version");s=t.getResponseHeader("X-Page-Title");p=t.getResponseHeader("State");
r=t.getResponseHeader("Navigate");redirect=t.getResponseHeader("Redirect");if(r){if(isNaN(r)){r=0;}setTimeout(function(){$(document).trigger("reload");
},r*1000);}if(p){p=p.replace(k,"");if(janddress.current!=p){janddress.set(p);}}if(s){document.title=d+" - "+s;}else{document.title=d;}if(q&&f&&q!=f){location.reload();
return false;}if(redirect){setTimeout(function(){janddress.go(redirect);},3*1000);}return true;}function j(q,p,t,r){if(b(t)!==true){return;}var u=t.getResponseHeader("Content-type");
if(u.indexOf("application/json")!==-1){$(document).trigger("json:response",[q]);return false;}var s={};s.value=janddress.current;s.response=q;s.type="navigate";
$(document).trigger(s,[t,a,r]);$(document).trigger("navigate:after",[t,a,r]);}function e(q){var p=q.value;if(o&&o.readyState<4){if(o.target){$(o.target).removeClass("loading");
}o.abort();}o=$.ajax({url:k+p,beforeSend:function(r){if(!q.reload){$(document).trigger("navigate:change",[r,a]);}$(document).trigger("navigate:before",[r,a]);
r.setRequestHeader("Async",true);if(q.target){if(a=$(q.target).data("context")){r.setRequestHeader("Context",a);}r.target=q.target;}},error:function(s){var r,t=s.getResponseHeader("Content-type");
if(t&&t.indexOf("application/json")!==-1){r=$.parseJSON(s.responseText);$(document).trigger("json:response",[r]);}else{$(document).trigger("navigate:error",[s,a]);
}if(a){a=false;}},success:function(s,r,t){$(document).trigger("navigate:response",[s,r,t,a,q.reload]);if(a){a=false;}}});}function h(q,r){var p=document.createElement("a");
p.href=q;if(p.hostname||p.protocol.length>1){if(location.protocol!==p.protocol||location.hostname!==p.hostname){location.href=q;return;}}if(janddress.go(q,r)){if(r){r=$(r);
if(r.data("context")){r.addClass("loading");}}}}function l(r){var q,p;p=$(this).attr("href");if(r.isDefaultPrevented()){return;}if(r.which>1||r.metaKey||r.ctrlKey||r.shiftKey||r.altKey){return;
}if(q=$(this).attr("target")){if(q==="self"){r.preventDefault();location.href=p;}return;}r.preventDefault();h(p,this);}function i(v){var u,t,s,r,q,p;u=$(this).attr("action");
s=(u.indexOf("?")===-1)?"?":"&";t=$(this).serialize();r=u+s+t;p=$(this).data("location")===false?$(this).data("location"):true;if($(this).attr("target")){return true;
}if(p===false){return true;}v.stopImmediatePropagation();h(r);return false;}function n(t){var p,r,u,s,q;s=janddress.current.parseURI();p=$(this).attr("name");
r=$(this).attr("value");u={};q=$(this).data("reset")||false;if(false!==q){$.each(q.split(","),function(){var v=this.toString();u[v]=null;});}if(encodeURI(s.query[p])==r){u[p]=null;
}else{u[p]=r;}$(document).trigger("location",[false,u]);}function c(v,p,t){var x,u,r,q,w={},s=[];p=p||janddress.current;r=p.parseURI();if(t){for(u in t){if(t[u]==null){delete (r.query[u]);
}else{r.query[u]=t[u];}}}h(r.build());}$(document).on("location",c);$(document).on("click",".query",n);$(document).on("reload",function(q,p){e({value:janddress.getCurrent(),reload:true,target:p});
});$(document).on("navigate:response",function(t,r,p,u,q,s){j(r,p,u,s);});$(document).on("click","a",l);$(document).on("redraw",function(q,p){$(p).find("form[method=get]").submit(i);
});$(document).find("form[method=get]").submit(i);function m(p){p=p||k;if(p){janddress.onChange(e);janddress.init(p);}}return{init:m,parseXHRHeaders:b,setLocation:c};
});