(function(){var a=[].slice;(function(g){var j,m,e,k,i,h,f,d,c,b,l;k=g.tourbus=function(){var n,o;n=1<=arguments.length?a.call(arguments,0):[];o=n[0];if(e.hasOwnProperty(o)){n=n.slice(1);
}else{if(o instanceof g){o="build";}else{if(typeof o==="string"){o="build";n[0]=g(n[0]);}else{g.error("Unknown method of $.tourbus --",n);}}}return e[o].apply(this,n);
};g.fn.tourbus=function(){var n;n=1<=arguments.length?a.call(arguments,0):[];return this.each(function(){n.unshift(g(this));k.apply(null,["build"].concat(a.call(n)));
return this;});};e={build:function(p,n){var o;if(n==null){n={};}n=g.extend(true,{},k.defaults,n);o=[];if(!(p instanceof g)){p=g(p);}p.each(function(){return o.push(f(this,n));
});if(o.length===0){g.error(""+p.selector+" was not found!");}if(o.length===1){return o[0];}return o;},destroyAll:function(){var o,p,n;n=[];for(p in d){o=d[p];
n.push(o.destroy());}return n;},expose:function(n){return n.tourbus={Bus:j,Leg:m};}};k.defaults={debug:false,autoDepart:false,target:"body",startAt:0,onDepart:function(){return null;
},onStop:function(){return null;},onLegStart:function(){return null;},onLegEnd:function(){return null;},leg:{scrollTo:null,scrollSpeed:150,scrollContext:100,orientation:"bottom",align:"left",width:"auto",margin:10,top:null,left:null,zindex:9999,arrow:"50%"}};
j=(function(){function n(p,o){this.id=i();this.$target=g(o.target);this.$el=g(p);this.$el.data({tourbus:this});this.options=o;this.currentLegIndex=null;
this.legs=null;this.legEls=this.$el.children("li");this.totalLegs=this.legEls.length;this._setupEvents();if(this.options.autoDepart){this.$el.trigger("depart.tourbus");
}this._log("built tourbus with el",p.toString(),"and options",this.options);}n.prototype.depart=function(){this.running=true;this.options.onDepart(this);
this._log("departing",this);this.legs=this._buildLegs();this.currentLegIndex=this.options.startAt;return this.showLeg();};n.prototype.stop=function(){if(!this.running){return;
}if(this.legs){g.each(this.legs,g.proxy(this.hideLeg,this));}this.currentLegIndex=this.options.startAt;this.options.onStop(this);return this.running=false;
};n.prototype.on=function(q,o,p){return this.$target.on(q,o,p);};n.prototype.currentLeg=function(){if(this.currentLegIndex===null){return null;}return this.legs[this.currentLegIndex];
};n.prototype.showLeg=function(q){var o,r,p;if(q==null){q=this.currentLegIndex;}o=this;r=this.legs[q];this._log("showLeg:",r);if(r.$target.length===0){g(document).one("redraw",function(s,t){r.$target=g(r.options.target);
r._configureTarget();r._position();o.options.onLegStart(r,o);});}else{p=this.options.onLegStart(r,this);}if(p!==false){return r.show();}};n.prototype.hideLeg=function(p){var q,o;
if(p==null){p=this.currentLegIndex;}q=this.legs[p];this._log("hideLeg:",q);o=this.options.onLegEnd(q,this);if(o!==false){return q.hide();}};n.prototype.repositionLegs=function(){if(this.legs){return g.each(this.legs,function(){return this.reposition();
});}};n.prototype.next=function(){this.hideLeg();this.currentLegIndex++;if(this.currentLegIndex>this.totalLegs-1){return this.stop();}return this.showLeg();
};n.prototype.prev=function(o){this.hideLeg();this.currentLegIndex--;if(this.currentLegIndex<0){return this.stop();}return this.showLeg();};n.prototype.destroy=function(){if(this.legs){g.each(this.legs,function(){return this.destroy();
});}this.legs=null;delete d[this.id];return this._teardownEvents();};n.prototype._buildLegs=function(){var o=this;if(this.legs){g.each(this.legs,function(p,q){return q.destroy();
});}return g.map(this.legEls,function(r,q){var p,t,s;p=g(r);t=p.data();s=new m({content:p.html(),target:t.el||"html",bus:o,index:q,rawData:t});s.render();
o.$target.append(s.$el);s._position();s.hide();return s;});};n.prototype._log=function(){if(!this.options.debug){return;}return console.log.apply(console,["TOURBUS "+this.id+":"].concat(a.call(arguments)));
};n.prototype._setupEvents=function(){this.$el.on("depart.tourbus",g.proxy(this.depart,this));this.$el.on("stop.tourbus",g.proxy(this.stop,this));this.$el.on("next.tourbus",g.proxy(this.next,this));
return this.$el.on("prev.tourbus",g.proxy(this.prev,this));};n.prototype._teardownEvents=function(){return this.$el.off(".tourbus");};return n;})();m=(function(){function n(o){this.bus=o.bus;
this.rawData=o.rawData;this.content=o.content;this.index=o.index;this.options=o;this.$target=g(o.target);this._setupOptions();this._configureElement();
this._configureTarget();this._configureScroll();this._setupEvents();this.bus._log("leg "+this.index+" made with options",this.options);}n.prototype.render=function(){var p,o;
p=this.options.orientation==="centered"?"":"tourbus-arrow";this.$el.addClass(" "+p+" tourbus-arrow-"+this.options.orientation+" ");o="<div class='tourbus-leg-inner'>\n  "+this.content+"\n</div>";
this.$el.css({width:this.options.width,zIndex:this.options.zindex}).html(o);return this;};n.prototype.destroy=function(){this.$el.remove();return this._teardownEvents();
};n.prototype.reposition=function(){this._configureTarget();return this._position();};n.prototype._position=function(){var p,q,r,o;if(this.options.orientation!=="centered"){r={};
q={top:"left",bottom:"left",left:"top",right:"top"};if(typeof this.options.arrow==="number"){this.options.arrow+="px";}r[q[this.options.orientation]]=this.options.arrow;
o="#"+this.id+".tourbus-arrow";this.bus._log("adding rule for "+this.id,r);h(""+o+":before, "+o+":after",r);}p=this._offsets();this.bus._log("setting offsets on leg",p);
return this.$el.css(p);};n.prototype.show=function(){this.$el.css({visibility:"visible",opacity:1,zIndex:this.options.zindex});return this.scrollIntoView();
};n.prototype.hide=function(){if(this.bus.options.debug){return this.$el.css({visibility:"visible",opacity:0.4,zIndex:0});}else{return this.$el.css({visibility:"hidden"});
}};n.prototype.scrollIntoView=function(){var o;if(!this.willScroll){return;}o=c(this.options.scrollTo,this.$el);this.bus._log("scrolling to",o,this.scrollSettings);
return g.scrollTo(o,this.scrollSettings);};n.prototype._setupOptions=function(){var o;o=this.bus.options.leg;this.options.top=c(this.rawData.top,o.top);
this.options.left=c(this.rawData.left,o.left);this.options.scrollTo=c(this.rawData.scrollTo,o.scrollTo);this.options.scrollSpeed=c(this.rawData.scrollSpeed,o.scrollSpeed);
this.options.scrollContext=c(this.rawData.scrollContext,o.scrollContext);this.options.margin=c(this.rawData.margin,o.margin);this.options.arrow=this.rawData.arrow||o.arrow;
this.options.align=this.rawData.align||o.align;this.options.width=this.rawData.width||o.width;this.options.zindex=this.rawData.zindex||o.zindex;return this.options.orientation=this.rawData.orientation||o.orientation;
};n.prototype._configureElement=function(){this.id="tourbus-leg-id-"+this.bus.id+"-"+this.options.index;this.$el=g("<div class='tourbus-leg'></div>");this.el=this.$el[0];
this.$el.attr({id:this.id});return this.$el.css({zIndex:this.options.zindex});};n.prototype._setupEvents=function(){this.$el.on("click",".tourbus-next",g.proxy(this.bus.next,this.bus));
this.$el.on("click",".tourbus-prev",g.proxy(this.bus.prev,this.bus));return this.$el.on("click",".tourbus-stop",g.proxy(this.bus.stop,this.bus));};n.prototype._teardownEvents=function(){return this.$el.off("click");
};n.prototype._configureTarget=function(){this.targetOffset=this.$target.offset()||{top:-1000,left:-1000};if(c(this.options.top,false)){this.targetOffset.top=this.options.top;
}if(c(this.options.left,false)){this.targetOffset.left=this.options.left;}this.targetWidth=this.$target.outerWidth();return this.targetHeight=this.$target.outerHeight();
};n.prototype._configureScroll=function(){this.willScroll=g.fn.scrollTo&&this.options.scrollTo!==false;return this.scrollSettings={offset:-this.options.scrollContext,easing:"linear",axis:"y",duration:this.options.scrollSpeed};
};n.prototype._offsets=function(){var u,q,p,r,t,v,o,s;p=this.$el.height();r=this.$el.width();t={};switch(this.options.orientation){case"centered":o=g(window).height();
t.top=this.options.top;if(!c(t.top,false)){t.top=(o/2)-(p/2);}t.left=(this.targetWidth/2)-(r/2);break;case"left":t.top=this.targetOffset.top;t.left=this.targetOffset.left-r-this.options.margin;
break;case"right":t.top=this.targetOffset.top;t.left=this.targetOffset.left+this.targetWidth+this.options.margin;break;case"top":t.top=this.targetOffset.top-p-this.options.margin;
t.left=this.targetOffset.left;break;case"bottom":t.top=this.targetOffset.top+this.targetHeight+this.options.margin;t.left=this.targetOffset.left;}s={top:["left","right"],bottom:["left","right"],left:["top","bottom"],right:["top","bottom"]};
if(b(this.options.orientation,s[this.options.align])){switch(this.options.align){case"right":t.left+=this.targetWidth-r;break;case"bottom":t.top+=this.targetHeight-p;
}}else{if(this.options.align==="center"){if(b(this.options.orientation,s.left)){v=this.targetWidth/2;q=r/2;u="left";}else{v=this.targetHeight/2;q=p/2;u="top";
}if(v>q){t[u]+=v-q;}else{t[u]-=q-v;}}}return t;};return n;})();l=0;i=function(){return l++;};d={};f=function(){var n;n=(function(r,p,q){q.prototype=r.prototype;
var s=new q,o=r.apply(s,p);return Object(o)===o?o:s;})(j,arguments,function(){});d[n.id]=n;return n;};c=function(o,n){if(o===null||typeof o==="undefined"){return n;
}return o;};b=function(n,o){return g.inArray(n,o||[])!==-1;};return h=(function(n){var o;n.type="text/css";document.getElementsByTagName("head")[0].appendChild(n);
o=document.styleSheets[document.styleSheets.length-1];return function(p,s){var r,q;q=g.map((function(){var u;u=[];for(r in s){u.push(r);}return u;})(),function(u){return""+u+":"+s[u];
}).join(";");try{if(o.insertRule){o.insertRule(""+p+" { "+q+" }",(o.cssRules||o.rules).length);}else{o.addRule(p,q);}}catch(t){}};})(document.createElement("style"));
})(jQuery);}).call(this);