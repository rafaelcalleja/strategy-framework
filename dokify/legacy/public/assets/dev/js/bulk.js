define(["form","confirmbox","modal","message"],function(d,b,a,e){function f(i,h){var g=this;this.dom=$(i);this.bulk=h;this.none=this.dom.data("bulk-action-none");
this.verify=this.dom.data("bulk-action-verify");this.dom.click(function(j){return g.submit(j);});}f.prototype.submit=function(k,i){if(i===undefined&&this.confirm(k)===true){return false;
}var h,j,g,l;h=this.dom.attr("href");j=this.dom.attr("target");l=this.dom.attr("method")||"POST";g=this.dom.data("bulk-action-message");messageType=this.dom.data("action-message-type")||"info";
this.bulk.submit(h,j,g,messageType,l);return false;};f.prototype.confirm=function(i){var g=this,h;if(this.verify==="any"&&this.bulk.current===0){h=new b();
h.show(i,function(){g.submit(i,true);});return true;}return false;};function c(i){var g=this;this.dom=$(i);this.set=this.dom.data("bulk-set");this.ctx=this.dom.data("bulk-ctx").find();
this.current=0;this.max=this.ctx.find(this.set).length;this.toggle=this.dom.data("bulk-toggle-class").find();this.actions=[];this.list={};this.full=false;
this.allSelected=this.dom.data("all-selected");var h=this.dom.data("bulk-selection").find();this.selection={current:0,template:h.html(),place:h,};this.reset();
this.ctx.on("click",this.set,function(){g.one(this);});this.dom.click(function(){g.click();});this.dom.data("bulk-actions").find().each(function(){g.actions.push(new f(this,g));
});this.dom.data("bulk-full").find().click(function(j){j.preventDefault();return g.fullSelection();});this.dom.data("bulk-clear").find().click(function(j){j.preventDefault();
return g.clear();});if(true==this.allSelected){$(i).click();}}c.prototype.fullSelection=function(){this.full=true;this.toggle.addClass("bulk-full");};c.prototype.clear=function(){this.full=false;
this.toggle.removeClass("bulk-any bulk-all bulk-full");this.ctx.find(this.set).click();this.list={};this.current=0;this.selection.current=0;this.dom.prop({indeterminate:false,checked:false});
};c.prototype.reset=function(h){var g=this,i;i=this.ctx.find(this.set);this.dom.prop({indeterminate:false,checked:false});this.toggle.removeClass("bulk-any bulk-all");
this.current=0;this.max=i.length;i.each(function(){var j=$(this).val();if(g.full){g.list[j]=true;}if(g.list[j]!==undefined){$(this).click();}});};c.prototype.submit=function(i,j,h,g,k){e.prototype.submit.apply(this,[i,j,h,g,k,this.full,this.list]);
};c.prototype.click=function(){if(this.dom.prop("indeterminate")===true){return this.setAll(true);}if(this.dom.prop("checked")){return this.setAll(true);
}return this.setAll(false);};c.prototype.setAll=function(g){this.ctx.find(this.set).each(function(){if(true===g&&false===$(this).prop("checked")){$(this).click();
}if(false===g&&true===$(this).prop("checked")){$(this).click();}});};c.prototype.one=function(h){var g=$(h).closest("li");if(h.checked){this.add(h);g.addClass("selected");
}else{this.remove(h);g.removeClass("selected");}this.change();};c.prototype.add=function(h){this.current++;var g=$(h).val();if(this.list[g]===undefined){this.selection.current++;
}this.list[g]=true;};c.prototype.remove=function(h){this.current--;this.selection.current--;if(this.full){this.full=false;this.toggle.removeClass("bulk-full");
}var g=$(h).val();delete this.list[g];};c.prototype.change=function(g){if(this.current===0){return this.none();}if(this.selection.template){this.selection.place.html(this.selection.template.replace("%s",this.selection.current));
}if(this.current===this.max){return this.all();}this.any();};c.prototype.none=function(){this.toggle.removeClass("bulk-any bulk-all bulk-full");this.dom.prop({indeterminate:false,checked:false});
};c.prototype.any=function(){this.toggle.removeClass("bulk-all").addClass("bulk-any");this.dom.prop({indeterminate:true,checked:false});};c.prototype.all=function(){this.toggle.addClass("bulk-any bulk-all");
this.dom.prop({indeterminate:false,checked:true});};c.init=function(){var h=new c(this);function g(j,k){var i=k.getResponseHeader("List");if(null===i){return;
}h.reset();$(document).one("navigate",g);}$(document).one("navigate",g);return h;};return c;});